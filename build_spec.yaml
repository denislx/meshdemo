version: 0.1             
component: build
timeoutInSeconds: 5000
shell: bash
env:
  exportedVariables:
    - version
steps:
  - type: Command
    command: |
      version=1.0
      echo "Version: ${version}"
  - type: Command
    command: | 
      export OCI_CLI_AUTH=instance_principal
      oci ce cluster create-kubeconfig --cluster-id ${OKE_OCID} --file kconfig --region ${OCI_REGION} --token-version 2.0.0  --kube-endpoint ${OKE_ENDPOINT}
      export KUBECONFIG="kconfig"
      kubectl get nodes
  - type: Command
    command: |
      ls
      chmod +x ./kubectl
      ./kubectl version
  - type: Command
    command: |
      docker build -t ams.ocir.io/frsxwtjslf35/meshdemo-homesvc:latest .
      docker tag ams.ocir.io/frsxwtjslf35/meshdemo-homesvc:latest ams.ocir.io/frsxwtjslf35/meshdemo-homesvc:${version}
outputArtifacts:
  - name: meshdemo-homesvc-latest
    type: DOCKER_IMAGE
    location: ams.ocir.io/frsxwtjslf35/meshdemo-homesvc:latest
  - name: meshdemo-homesvc
    type: DOCKER_IMAGE
    location: ams.ocir.io/frsxwtjslf35/meshdemo-homesvc